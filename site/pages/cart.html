<!DOCTYPE html>

<html>
	<head>
		<title>Compu c</title>
		<link rel="stylesheet" type="text/css" href="../style.css" />
		<link rel="shortcut icon" type="image/x-icon" href="../favicon.ico" />
	</head>
	
	<body>
		<!-- All elements in the header: header img, login box and button -->
		<div id="headerDiv">
			<img id="siteLogo" src="../images/site_logo_transparent.png" width=400 />
			
			<!-- Greeting displayed when the user is logged in -->
			<h2 id="greeting">Hello, NAME.</h2>
			
			<!-- Login box -->
			<div id="loginBoxDiv">
				<h2>Login</h2>
				<table>
					<tr>
						<th>Name:</th>
						<td><input id="nameBox" type="text"></input></td>
					</tr>
					
					<tr>
						<th>Password:</th>
						<td><input id="passwordBox" type="password"></input></td>
					</tr>
					
					<tr>
						<!-- Buttons -->
						<td></td>
						<td>
							<button id="loginButton">Log in</button>
						</td>
					</tr>
				</table>
			</div>
		</div>
		
		<!-- The bar with a list of buttons (links) to go to the other site's pages -->
		<div id="menubarDiv">
			<a href="../index.html">Home</a>
			<a href="shop.html">Shop</a>
			Cart
			<a href="myDetails.html">My Details</a>
		</div>
		
		<div id="shoppingCartDiv" class="segmentDiv">
			<img id="shoppingCart" src="../images/shopping_cart_icon.png" height=48 />
			<h1>Shopping Cart</h1>
		</div>
		
		<!-- Div used to display products selected to purchase -->
		<div id="productsCart" class="segmentDiv">
			<p>Selected products:</p>
			<button onclick="inCart()">see products</button>			
			<h2 id="cartObjects"></h2>
		
		</div>
		
		<script>
		
			/* -========- LOGIN BOX JAVASCRIPT -========- */
			var loginBoxDiv = document.getElementById("loginBoxDiv");
			var nameBox = document.getElementById("nameBox");
			var pwdBox = document.getElementById("passwordBox");
			var greeting = document.getElementById("greeting");
			
			function loginMode()
			{
				loginBoxDiv.style.display = "block";
				greeting.style.display = "none";
			}
			
			function greetingMode()
			{
				loginBoxDiv.style.display = "none";
				greeting.style.display = "block";
				var custName = JSON.parse(localStorage.getItem("customer")).name;
				greeting.innerHTML = "Hello, " + custName + ".";
			}
			
			function onLoginButtonClicked()
			{
				// Ensure the user has actually made an account
				var accCreated = !(localStorage.getItem("customer") === null);
				
				if (accCreated) {
					var name = nameBox.value;
					var password = pwdBox.value;
					
					cust = JSON.parse(localStorage.getItem("customer"));
					var validLogin = (name === cust.name && password === cust.password);
					
					console.log("cust name: " + cust.name + " entered name: " + name);
					console.log("cust password: " + cust.password + " entered password: " + password);
					
					if (validLogin) {
						localStorage.setItem("loggedIn", "true");
						alert("Successfully logged in!");
						greetingMode();
					} else {
						alert("Entered name or password was not corect! Please try again.");
					}
				} else {
					alert("You must create an account by signing up before logging in.");
				}
			}
			
			loginButton.addEventListener("click", onLoginButtonClicked);
			
			var accCreated = !(localStorage.getItem("customer") === null);
			var loggedIn = false;
			
			if (accCreated) {
				loggedIn = (localStorage.getItem("loggedIn") === "true");
			}
			
			/* If user is signed in, display greeting */
			/* Otherwise, display login box */
			if (loggedIn) {
				greetingMode();
			} else {
				loginMode();
			}
			
			/* -========- END OF LOGIN BOX JAVASCRIPT -========- */
			
			/* -========- DISPLAY PRODUCTS IN CART -===========- */
			function inCart()
			{
			var product;
			var picture;
			for(i=0;i<20;i++)
				{
					picture = "<img src=\"../products/" + localStorage.getItem([i]+" thumbnail") + "\" align=\"left\" width=50 alt=\"product thumbnail\" />";
					product = localStorage.getItem([i]+" name");
					product += localStorage.getItem([i]+" category");
					product += localStorage.getItem([i]+" price");
					if(product == "0")
					{
						continue;
					}
					else{
						document.getElementById("productsCart").innerHTML += picture + product + "<br><br>";
					}
				}
			}
			/* -=========- END OF DISPLAY PRODUCTS IN CART -===== */
		</script>
		
	</body>
</html>