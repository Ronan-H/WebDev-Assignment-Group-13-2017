<!DOCTYPE html>

<html>
	<head>
		<title>Compu c: My Details</title>
		<link rel="stylesheet" type="text/css" href="../style.css" />
		<link rel="shortcut icon" type="image/x-icon" href="../favicon.ico" />
	</head>
	
	<body>
		<!-- All elements in the header: header img, login box and button -->
		<div id="headerDiv">
			<img id="siteLogo" src="../images/site_logo.png" height=300 />
		</div>
		
		<!-- The bar with a list of buttons (links) to go to the other site's pages -->
		<div id="menubarDiv">
			<a href="../index.html">Home</a>
			<a href="../pages/shop.html">Shop</a>
			<a href="../pages/cart.html">Cart</a>
			My Details
		</div>
		
		<div id="loginSignupDiv" class="segmentDiv">
			<h2>Login / Signup</h2>
			<table>
				<tr>
					<th>Name:</th>
					<td><input id="nameBox" type="text"></input></td>
				</tr>
				
				<tr>
					<th>Password:</th>
					<td><input id="passwordBox" type="password"></input></td>
				</tr>
				
				<tr>
					<!-- Buttons -->
					<td></td>
					<td>
						<button id="loginButton">Log in</button>
						<button id="signupButton">Sign Up</button>
					</td>
				</tr>
			</table>
		</div>
		
		<div id="detailsDiv" class="segmentDiv">
			<h1>placeholder for detailsDiv</h1>
		</div>
		
		<script>
			var loginSignupDiv = document.getElementById("loginSignupDiv");
			var detailsDiv = document.getElementById("detailsDiv");
			var nameBox = document.getElementById("nameBox");
			var pwdBox = document.getElementById("passwordBox");
			var loginButton = document.getElementById("loginButton");
			var signupButton = document.getElementById("signupButton");
			
			var cust;
			
			// Hide details box, show loginSignup box
			function loginSignupMode()
			{
				loginSignupDiv.style.display = "block";
				detailsDiv.style.display = "none";
			}
			
			// Hide loginSignup box, show details box
			function detailsMode()
			{
				loginSignupDiv.style.display = "none";
				detailsDiv.style.display = "block";
			}
			
			function onSignupButtonClicked()
			{
				// Create the account in localStorage for the person signing up
				var name = nameBox.value;
				var password = pwdBox.value;
				
				// Create customer object
				cust = {name:name, password:password, 
					email:"email not set", address:"address not set",
					ccNumber:"credit card num not set"};
				
				localStorage.setItem("customer", JSON.stringify(cust));
				localStorage.setItem("loggedIn", "true");
				alert("Signup successful! You are now logged in.");
				
				// Clear and hide the signup box
				nameBox.value = "";
				pwdBox.value = "";
				
				detailsMode();
			}
			
			function onLoginButtonClicked()
			{
				// Ensure the user has actually made an account
				var accCreated = !(localStorage.getItem("customer") === null);
				
				if (accCreated) {
					var name = nameBox.value;
					var password = pwdBox.value;
					
					cust = JSON.parse(localStorage.getItem("customer"));
					var validLogin = (name === cust.name && password === cust.password);
					
					console.log("cust name: " + cust.name + " entered name: " + name);
					console.log("cust password: " + cust.password + " entered password: " + password);
					
					if (validLogin) {
						localStorage.setItem("loggedIn", "true");
						alert("Successfully logged in!");
						detailsMode();
					} else {
						alert("Entered name or password was not corect! Please try again.");
					}
				} else {
					alert("You must create an account by signing up before logging in.");
				}
			}
			
			// Show the correct layout (eg. hide login box if already logged in)
			var accCreated = !(localStorage.getItem("customer") === null);
			var loggedIn = false;
			
			if (accCreated) {
				loggedIn = (localStorage.getItem("loggedIn") === "true");
			}
			
			if (loggedIn) {
				detailsMode();
			} else {
				loginSignupMode();
			}
			
			signupButton.addEventListener("click", onSignupButtonClicked);
			loginButton.addEventListener("click", onLoginButtonClicked);
			
			if (accCreated) {
				// Check if user is logged in
				var loggedIn = !(localStorage.getItem("loggedIn") === null);
				
			} else {
				// Show sign up page
				
			}
		</script>
		
	</body>
</html>